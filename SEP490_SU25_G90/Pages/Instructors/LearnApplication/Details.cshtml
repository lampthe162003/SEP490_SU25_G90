@page "/Instructors/LearnApplication/Detail/{id:int}"
@model SEP490_SU25_G90.Pages.Instructors.LearnApplication.DetailModel

@{
    ViewData["Title"] = "Chi tiết hồ sơ học viên";
    Layout = "~/Pages/Shared/_InstructorLayout.cshtml";
}

@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger">@TempData["ErrorMessage"]</div>
}
@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success">@TempData["SuccessMessage"]</div>
}



<h2 class="mb-4 text-primary fw-bold">📄 Chi tiết hồ sơ học viên</h2>

@if (Model.Detail != null)
{
    <div class="card shadow-lg border-0 detail-card">
        <div class="row">
            <!-- Cột trái: Thông tin học viên -->
            <div class="col-md-7 border-end pe-4">
                <h5 class="detail-section-title">👤 Thông tin học viên</h5>

                <div class="mb-3">
                    <label class="detail-label">Họ tên:</label>
                    <div class="detail-value">@Model.Detail.LearnerFullName</div>
                </div>

                <div class="mb-3">
                    <label class="detail-label">Ngày sinh:</label>
                    <div class="detail-value">@Model.Detail.LearnerDob?.ToString("dd/MM/yyyy")</div>
                </div>

                <div class="mb-3">
                    <label class="detail-label">Số CCCD:</label>
                    <div class="detail-value">@Model.Detail.LearnerCccdNumber</div>
                </div>

                <div class="mb-3">
                    <label class="detail-label">Loại bằng đăng ký:</label>
                    <div class="detail-value">@Model.Detail.LicenceTypeName</div>
                </div>

                <div class="mb-3">
                    <label class="detail-label">Lớp học:</label>
                    <div class="detail-value">
                        @if (!string.IsNullOrWhiteSpace(Model.Detail.ClassName))
                        {
                            <span class="badge bg-info text-dark badge-class">@Model.Detail.ClassName</span>
                        }
                        else
                        {
                            <span class="text-muted">Không có lớp học</span>
                        }
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-semibold">Tổng giờ thực hành:</label>
                    <div class="form-control bg-light">
                        @Model.Detail.TotalPracticalHours.ToString("0.##") giờ
                        <small class="text-muted">(Yêu cầu: @Model.Detail.RequiredPracticalHours giờ)</small>
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-semibold">Tổng km thực hành:</label>
                    <div class="form-control bg-light">
                        @Model.Detail.TotalPracticalKm.ToString("0.##") km
                        <small class="text-muted">(Yêu cầu: @Model.Detail.RequiredPracticalKm km)</small>
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-semibold">Đủ điều kiện thi tốt nghiệp:</label>
                    <div class="form-control bg-light">
                        @{
                            var isEligible = Model.Detail.TotalPracticalHours >= Model.Detail.RequiredPracticalHours && 
                                           Model.Detail.TotalPracticalKm >= Model.Detail.RequiredPracticalKm;
                        }
                        <span class="@(isEligible ? "text-success fw-bold" : "text-danger fw-bold")">
                            @(isEligible ? "✅ Đạt" : "❌ Chưa đạt")
                        </span>
                        <small class="text-muted d-block mt-1">
                            (Cần đạt đủ cả giờ thực hành và km thực hành)
                        </small>
                    </div>
                </div>

            </div>

            <!-- Cột phải: Điểm thi -->
            <div class="col-md-5 ps-4">
                <h5 class="detail-section-title">Điểm thi tốt nghiệp</h5>

                <div class="mb-3">
                    <label class="detail-label">Điểm lý thuyết:</label>
                    <div class="detail-value">@Model.Detail.TheoryScore</div>
                </div>

                <div class="mb-3">
                    <label class="detail-label">Điểm mô phỏng:</label>
                    <div class="detail-value">@Model.Detail.SimulationScore</div>
                </div>

                <div class="mb-3">
                    <label class="detail-label">Điểm đường trường:</label>
                    <div class="detail-value">@Model.Detail.ObstacleScore</div>
                </div>

                <div class="mb-3">
                    <label class="detail-label">Điểm sa hình:</label>
                    <div class="detail-value">@Model.Detail.PracticalScore</div>
                </div>

                <!-- Nút thao tác -->
                <div class="d-flex flex-column mt-4">
                    @{
                         isEligible = Model.Detail.TotalPracticalHours >= Model.Detail.RequiredPracticalHours && 
                                       Model.Detail.TotalPracticalKm >= Model.Detail.RequiredPracticalKm;
                    }
                    
                    @if (isEligible)
                    {
                        <a asp-page="UpdateLearningApplicationScore" asp-route-id="@Model.Detail.LearningId" class="btn btn-warning btn-lg mb-2">
                            ✏️ Sửa điểm
                        </a>
                    }
                    else
                    {
                        <button class="btn btn-secondary btn-lg mb-2" disabled title="Học viên chưa đủ điều kiện thi tốt nghiệp">
                            ✏️ Sửa điểm
                        </button>
                        <small class="text-danger mb-2">
                            <i class="fas fa-info-circle"></i> 
                            Không thể sửa điểm vì học viên chưa đủ điều kiện thi tốt nghiệp
                        </small>
                    }
                    
                    <a asp-page="List" class="btn btn-secondary btn-lg">
                        ⬅️ Quay lại
                    </a>
                </div>
            </div>
        </div>
    </div>
}
else
{
    <div class="alert alert-danger mt-4">Không tìm thấy hồ sơ học viên.</div>
}

@section Styles{
    <style>
        .detail-card {
            border-radius: 12px;
            padding: 20px;
            background: #fff;
        }

        .detail-section-title {
            font-weight: 600;
            color: #555;
            margin-bottom: 15px;
        }

        .detail-label {
            font-weight: 600;
            color: #444;
            margin-bottom: 5px;
        }

        .detail-value {
            background: #f8f9fa;
            padding: 8px 12px;
            border-radius: 6px;
        }

        .badge-class {
            font-size: 0.9rem;
            padding: 6px 10px;
            border-radius: 8px;
        }
    </style>
}

